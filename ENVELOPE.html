<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Envelope Quotation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .toggle-switch input[type="checkbox"] { opacity: 0; width: 0; height: 0; }
    .toggle-switch .slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc; transition: .4s; border-radius: 34px;
    }
    a { padding: 5px 15px 5px; background-color: #004494; color: whitesmoke;
        text-decoration: none; margin: 10px; border-radius: 5px; }
    .toggle-switch .slider:before {
      position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px;
      background-color: white; transition: .4s; border-radius: 50%;
    }
    .toggle-switch input:checked + .slider { background-color: #2196F3; }
    .toggle-switch input:checked + .slider:before { transform: translateX(26px); }
    .toggle-switch input:checked ~ .dot { transform: translateX(26px); }
  </style>
</head>
<nav class="w-full text-white py-3 px-6 shadow-md fixed top-0 left-0 z-50 bg-white">
  <div class="max-w-7xl mx-auto flex justify-start space-x-4">
    <a class="nav-item" href="index2.html">Booklet</a>
    <a class="nav-item" href="index.html">Cut to Sheet</a>
    <a class="nav-item" href="kappabox.html">Kappa Box</a>
    <a class="nav-item" href="index3.html">Bag</a>
    <a class="nav-item" href="ENVELOPE.html">Envelope</a>
  </div>
</nav>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex justify-center p-4" style="padding-top: 72px;">
  <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-xl">
    <!-- Logo Section -->
    <div style="text-align:center; margin-bottom:20px;">
      <img src="logo.png" alt="Logo" style="height:60px; display:inline-block;">
    </div>
    <h2 class="text-3xl font-extrabold text-gray-800 mb-6 text-center">Envelope Quotation Generator</h2>
    <div class="mb-6">
      <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
      <input type="number" id="quantity"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-6">
      <div>
        <label for="standardSize" class="block text-sm font-medium text-gray-700 mb-1">Standard Size</label>
        <select id="standardSize" onchange="applyStandardSize()"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="">-- Select Standard Size --</option>
          <option value="A4Center">A4 Center Pasting</option>
          <option value="ChqKotak">Chq Size Kotak</option>
          <option value="ChqRegular">Chq Size Regular</option>
          <option value="NineFiveKotak">9.5x4.5 Kotak</option>
          <option value="NineFiveCenter">9.5x4.5 Center Pasting</option>
        </select>
      </div>
      <div>
        <label for="envelopeType" class="block text-sm font-medium text-gray-700 mb-1">Envelope Type</label>
        <select id="envelopeType"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="kotak">Kotak</option>
          <option value="centerPasting">Center Pasting</option>
        </select>
      </div>
      <div>
        <label for="width" class="block text-sm font-medium text-gray-700 mb-1">Width (inches)</label>
        <input type="number" id="width" step="0.01"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
      </div>
      <div>
        <label for="height" class="block text-sm font-medium text-gray-700 mb-1">Height (inches)</label>
        <input type="number" id="height" step="0.01"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
      </div>
      <div>
        <label for="gsm" class="block text-sm font-medium text-gray-700 mb-1">GSM</label>
        <input type="number" id="gsm"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" />
      </div>
      <div>
        <label for="paperType" class="block text-sm font-medium text-gray-700 mb-1">Paper Type</label>
        <select id="paperType"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="Allabaster">Allabaster</option>
          <option value="Maplitho">Maplitho</option>
          <option value="AGradeMaplitho">A Grade Maplitho</option>
          <option value="BGrade">B Grade</option>
          <option value="Artpaper">Artpaper</option>
          <option value="Artcard">Artcard</option>
        </select>
      </div>
      <div>
        <label for="makingType" class="block text-sm font-medium text-gray-700 mb-1">Making Type</label>
        <select id="makingType"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="punching">Punching & Pasting</option>
          <option value="direct">Direct Pasting</option>
        </select>
      </div>
      <div>
        <label for="dieType" class="block text-sm font-medium text-gray-700 mb-1">Die Type</label>
        <select id="dieType"
          class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="old">Old</option>
          <option value="new">New (as per Artwork)</option>
        </select>
      </div>
      <div class="md:col-span-2 flex flex-col sm:flex-row items-start sm:items-center justify-around space-y-4 sm:space-y-0 sm:space-x-4 mt-4">
        <label for="gummingFlap" class="flex items-center cursor-pointer">
          <div class="relative toggle-switch">
            <input type="checkbox" id="gummingFlap" class="sr-only peer" />
            <div class="block bg-gray-300 w-14 h-8 rounded-full"></div>
            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
          </div>
          <span class="ml-3 text-gray-700 font-medium">Add Gumming Flap</span>
        </label>
        <label for="window" class="flex items-center cursor-pointer">
          <div class="relative toggle-switch">
            <input type="checkbox" id="window" class="sr-only peer" />
            <div class="block bg-gray-300 w-14 h-8 rounded-full"></div>
            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
          </div>
          <span class="ml-3 text-gray-700 font-medium">Add Window</span>
        </label>
      </div>
    </div>
    <button onclick="calculateCost()"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-400">
      Calculate Total Cost
    </button>
    <div id="result" class="mt-8 p-6 bg-blue-50 border border-blue-200 rounded-lg shadow-inner text-gray-800 text-sm leading-relaxed">
      <p class="text-center text-gray-500">Enter details and click "Calculate Total Cost" to see results.</p>
    </div>
  </div>
  <script>
    const standardSizes = {
      A4Center: { width: 12, height: 9.7, type: "centerPasting" },
      ChqKotak: { width: 9.25, height: 4.25, type: "kotak" },
      ChqRegular: { width: 9.25, height: 4.25, type: "centerPasting" },
      NineFiveKotak: { width: 9.5, height: 4.5, type: "kotak" },
      NineFiveCenter: { width: 9.5, height: 4.5, type: "centerPasting" }
    };
    const paperRates = {
      Allabaster: 80,
      Maplitho: 75,
      AGradeMaplitho: 76,
      BGrade: 66,
      Artpaper: 78,
      Artcard: 78
    };
    const fullSheets = [
      { name: "18x25", w: 18, h: 25 },
      { name: "18x23", w: 18, h: 23 },
      { name: "15x20", w: 15, h: 20 },
      { name: "20x30", w: 20, h: 30 },
      { name: "15x25", w: 15, h: 25 },
      { name: "12x23", w: 12, h: 23 },
      { name: "12x25", w: 12, h: 25 },
      { name: "19x25", w: 19, h: 25 }
    ];
    function applyStandardSize() {
      const selected = document.getElementById("standardSize").value;
      if (standardSizes[selected]) {
        const { width, height, type } = standardSizes[selected];
        document.getElementById("width").value = width;
        document.getElementById("height").value = height;
        document.getElementById("envelopeType").value = type;
      }
    }
    function calculateCost() {
      const width = parseFloat(document.getElementById("width").value);
      const height = parseFloat(document.getElementById("height").value);
      const type = document.getElementById("envelopeType").value;
      const gsm = parseFloat(document.getElementById("gsm").value);
      const qty = parseInt(document.getElementById("quantity").value);
      const paperType = document.getElementById("paperType").value;
      const ratePerKg = paperRates[paperType];
      const makingType = document.getElementById("makingType").value;
      const dieType = document.getElementById("dieType").value;
      const addGumming = document.getElementById("gummingFlap").checked;
      const addWindow = document.getElementById("window").checked;
      if (isNaN(width) || isNaN(height) || isNaN(gsm) || isNaN(qty) || !ratePerKg) {
        document.getElementById("result").innerHTML = `<span class="text-red-600 font-semibold">Please fill all fields correctly with valid numbers.</span>`;
        return;
      }
      let openW = type === "kotak" ? width + 1 : Math.min(1, width * 0.15) + width + 0.5;
      let openH = type === "kotak" ? Math.min(1.25, height * 0.2) + height + (height * 0.9) : height * 2 + 0.5;
      let bestFit = null;
      let fitCandidates = [];
      fullSheets.forEach(sheet => {
        [
          { sw: sheet.w, sh: sheet.h },
          { sw: sheet.h, sh: sheet.w }
        ].forEach(orient => {
          let usableW = orient.sw - 0.8;
          let usableH = orient.sh - 0.3;
          let fitW = Math.floor(usableW / openW);
          let fitH = Math.floor(usableH / openH);
          let ups = fitW * fitH;
          let usedArea = ups * (openW * openH);
          let usableArea = usableW * usableH;
          let wastage = usableArea - usedArea;
          if (ups > 0) {
            fitCandidates.push({
              name: sheet.name,
              ups,
              wastage,
              usedArea,
              usableArea,
              sheetArea: sheet.w * sheet.h,
              originalSheet: sheet,
              appliedOrientation: orient
            });
          }
        });
      });
      fitCandidates.sort((a, b) => a.wastage - b.wastage);
      if (fitCandidates.length > 0) {
        bestFit = fitCandidates[0];
      }
      if (qty > 20000 && (width === 9.25 && height === 4.25)) {
        const nineteenXTwentyFiveSheet = fullSheets.find(s => s.name === "19x25");
        if (nineteenXTwentyFiveSheet) {
          let best19x25FitForEnvelope = null;
          [
            { sw: nineteenXTwentyFiveSheet.w, sh: nineteenXTwentyFiveSheet.h },
            { sw: nineteenXTwentyFiveSheet.h, sh: nineteenXTwentyFiveSheet.w }
          ].forEach(orient => {
            let usableW = orient.sw - 0.8;
            let usableH = orient.sh - 0.3;
            let fitW = Math.floor(usableW / openW);
            let fitH = Math.floor(usableH / openH);
            let ups = fitW * fitH;
            let usedArea = ups * (openW * openH);
            let usableArea = usableW * usableH;
            let wastage = usableArea - usedArea;
            if (ups > 0) {
              if (!best19x25FitForEnvelope || ups > best19x25FitForEnvelope.ups) {
                best19x25FitForEnvelope = {
                  name: nineteenXTwentyFiveSheet.name,
                  ups,
                  wastage,
                  usedArea,
                  usableArea,
                  sheetArea: nineteenXTwentyFiveSheet.w * nineteenXTwentyFiveSheet.h
                };
              }
            }
          });
          if (best19x25FitForEnvelope) {
            bestFit = best19x25FitForEnvelope;
          }
        }
      }
      if (!bestFit) {
        document.getElementById("result").innerHTML = `<span class="text-red-600 font-semibold">Envelope too large to fit efficiently on any available sheet.</span>`;
        return;
      }
      const sheetArea = bestFit.sheetArea;
      const wastageSheets = qty > 10000 ? Math.ceil(qty / bestFit.ups * 0.03) :
        qty > 6000 ? 300 :
        qty > 4000 ? 225 :
        qty > 2000 ? 150 : 100;
      const estimateshet = Math.ceil(qty / bestFit.ups);
      const totalSheets = Math.ceil(qty / bestFit.ups) + wastageSheets;
    
      const paperCostPerSheet = (sheetArea * gsm * ratePerKg) / 3100 / 500;
      const paperCost = paperCostPerSheet * totalSheets;
      const totalImpressions = Math.ceil((qty / bestFit.ups + wastageSheets) / 1000);
      const printingCost = bestFit.name === "20x30"
        ? totalImpressions * 500 + 2200
        : totalImpressions * 400 + 1700;
      // --- ADVANCED MAKING COST LOGIC ---
      let makingCost;
      if (makingType === "direct") {
        let makingRate = qty > 30000 ? 250 : qty > 10000 ? 300 : 400;
        if (paperType === "Artpaper") {
          makingRate = 900;
        } else if (paperType === "Artcard") {
          makingRate = 1200;
        }
        makingCost = makingRate * Math.ceil(qty / 1000);
      } else { // Punching & Pasting
        let perQtyCost;
        if (qty < 6000) {
          if (paperType === "Artpaper") {
            perQtyCost = 500;
          } else if (paperType === "Artcard") {
            perQtyCost = 800;
          } else {
            perQtyCost = 400;
          }
        } else if (qty >= 6000 && qty < 15000) {
          if (paperType === "Artpaper") {
            perQtyCost = 400;
          } else if (paperType === "Artcard") {
            perQtyCost = 700;
          } else {
            perQtyCost = 350;
          }
        } else if (qty >= 15000) {
          if (paperType === "Artpaper") {
            perQtyCost = 350;
          } else if (paperType === "Artcard") {
            perQtyCost = 600;
          } else {
            perQtyCost = 300;
          }
        }
        makingCost = (Math.ceil(estimateshet / 1000) * 400) + (Math.ceil(qty / 1000) * perQtyCost);
      }
      // -----------------------------------
      const dieCost = dieType === "old"
        ? 300
        : ["12x23", "12x25", "15x20"].includes(bestFit.name)
          ? 1500
          : 2000;
      let gummingRate = qty > 20000 ? 150 : qty > 10000 ? 200 : qty > 5000 ? 250 : 300;
      let gummingCost = addGumming ? gummingRate * Math.ceil(qty / 1000) : 0;
      let windowRate = qty > 20000 ? 80 : qty > 10000 ? 120 : qty > 5000 ? 150 : 200;
      let windowCost = addWindow ? windowRate * Math.ceil(qty / 1000) : 0;
      const totalCost = paperCost + printingCost + makingCost + dieCost + gummingCost + windowCost;
      const finalRate = totalCost / qty;
      document.getElementById("result").innerHTML = `
        <h3 class="text-xl font-bold text-gray-800 mb-4">Quotation Summary</h3>
        <div>
          <div>Envelope Type:${type}</div>
          <div>Size:${width} × ${height} in</div>
          <div>GSM:${gsm}</div>
          <div>Paper:${paperType}</div>
          <div>Making:${makingType}</div>
          <div>Die:${dieType}</div>
          <div>Quantity:${qty}</div>
          <div>Gumming Flap:${addGumming ? "Yes" : "No"}</div>
          <div>Window:${addWindow ? "Yes" : "No"}</div>
        </div>
        <hr class="my-4 border-gray-300">
        <div class="text-lg font-bold text-gray-900 flex justify-between items-center mb-2">
          <span>Total Estimated Cost:</span> <span class="text-blue-600">₹${totalCost.toFixed(2)}</span>
        </div>
        <div class="text-lg font-bold text-gray-900 flex justify-between items-center">
          <span>Final Rate per Envelope:</span> <span class="text-blue-600">₹${finalRate.toFixed(2)}</span>
        </div>
        <hr class="my-4 border-gray-300">
        <h4 class="text-md font-semibold text-gray-800 mb-2">Production Details:</h4>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-gray-700 text-sm">
          <span class="font-medium">Open Size:</span> <span>${openW.toFixed(2)} × ${openH.toFixed(2)} in</span>
          <span class="font-medium">Best Sheet:</span> <span>${bestFit.name}</span>
          <span class="font-medium">UPS (Units Per Sheet):</span> <span>${bestFit.ups}</span>
          <span class="font-medium">Wastage Area:</span> <span>${bestFit.wastage.toFixed(2)} sq.in (${(bestFit.wastage / bestFit.usableArea * 100).toFixed(1)}%)</span>
          <span class="font-medium">Wastage Sheets:</span> <span>${wastageSheets}</span>
          <span class="font-medium">Total Sheets Required:</span> <span>${totalSheets}</span>
        </div>
        <h4 class="text-md font-semibold text-gray-800 mt-4 mb-2">Cost Breakup:</h4>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-gray-700 text-sm">
          <span class="font-medium">Paper Cost:</span> <span>₹${paperCost.toFixed(2)}</span>
          <span class="font-medium">Printing Cost:</span> <span>₹${printingCost.toFixed(2)}</span>
          <span class="font-medium">Making Cost:</span> <span>₹${makingCost.toFixed(2)}</span>
          <span class="font-medium">Die Cost:</span> <span>₹${dieCost}</span>
          <span class="font-medium">Gumming Flap Cost:</span> <span>₹${gummingCost.toFixed(2)}</span>
          <span class="font-medium">Window Cost:</span> <span>₹${windowCost.toFixed(2)}</span>
        </div>
      `;
    }

    document.addEventListener('DOMContentLoaded', () => {
      const gummingCheckbox = document.getElementById('gummingFlap');
      const windowCheckbox = document.getElementById('window');
      const applyToggleStyles = (checkbox) => {
        const slider = checkbox.nextElementSibling;
        const dot = slider.nextElementSibling;
        if (checkbox.checked) {
          slider.classList.add('bg-blue-600');
          slider.classList.remove('bg-gray-300');
          dot.style.transform = 'translateX(26px)';
        } else {
          slider.classList.add('bg-gray-300');
          slider.classList.remove('bg-blue-600');
          dot.style.transform = 'translateX(0)';
        }
      };
      gummingCheckbox.addEventListener('change', () => applyToggleStyles(gummingCheckbox));
      windowCheckbox.addEventListener('change', () => applyToggleStyles(windowCheckbox));
      applyToggleStyles(gummingCheckbox);
      applyToggleStyles(windowCheckbox);

      // --------- NEW LOGIC FOR PAPER TYPE / MAKING TYPE ---------
      const paperTypeSelect = document.getElementById('paperType');
      const makingTypeSelect = document.getElementById('makingType');
      const directOption = makingTypeSelect.querySelector('option[value="direct"]');

      function updateMakingTypeOptions() {
        const selectedPaper = paperTypeSelect.value;
        if (selectedPaper === 'Artcard' || selectedPaper === 'Artpaper') {
          directOption.disabled = true;
          if (makingTypeSelect.value === 'direct') {
            makingTypeSelect.value = 'punching';
          }
        } else {
          directOption.disabled = false;
        }
      }
      paperTypeSelect.addEventListener('change', updateMakingTypeOptions);
      updateMakingTypeOptions();
      // ---------------------------------------------------------
    });
  </script>
</body>
</html>
